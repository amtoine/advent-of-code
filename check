#!/usr/bin/env nu


def main [
  scripts_dir: string
  inputs_dir: string = "inputs"
  answers_dir: string = "answers"
] {
  ls $scripts_dir
  | each {|script id|
    print $"(ansi yellow_bold)Day ($id + 1)(ansi reset):"

    let answers = (open $"($answers_dir)/($id + 1).json")

    print -n $"  (ansi default_dimmed)Running silver...(ansi reset) "
    let silver = (^$script.name $"($inputs_dir)/($id + 1).txt")
    print "ok"
    print -n $"  (ansi default_dimmed)Running gold...(ansi reset) "
    let gold = (^$script.name $"($inputs_dir)/($id + 1).txt" --gold)
    print "ok"

    mut good = true
    if ($silver != $answers.silver) {
      print -n $"(ansi red_bold)silver bad(ansi reset): (ansi red)expected ($answers.silver), got ($silver)(ansi reset)"
      $good = false
      print ""
    }
    if ($gold != $answers.gold) {
      print -n $"(ansi red_bold)gold bad(ansi reset): (ansi red)expected ($answers.gold), got ($gold)(ansi reset)"
      $good = false
      print ""
    }

    if ($good) {
      print $"(ansi green_bold)good(ansi reset)"
    }
  }
}